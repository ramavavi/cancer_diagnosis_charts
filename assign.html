<html>
  <head>
    <title>Page Title</title>
    <style>
      body {
        /* background-color: lightblue; */
      }

      h1 {
        /* color: white; */
        text-align: center;
      }

      p {
        font-family: verdana;
        font-size: 20px;
      }
      .chart-container {
        /* background-color: grey; */
        position: relative;
        margin: auto;
        height: 200px;
        width: 500px;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>

  <body>
    <!-- <h1 onclick="changeHeading()">This is a Heading</h1> -->
    <!-- <p>This is a paragraph.</p> -->
    <!-- <div>
		<canvas id="myChart"></canvas>
	</div> -->
    <h2>Line Chart for patients discharged after year 1900</h2>
    <div class="chart-container">
      <canvas id="myChart"></canvas>
    </div>
<br></br>
<br></br>
		<h2>Pie Chart for cancer patients with differnt age groups</h2>
    <div class="chart-container">
      <canvas id="age-group-pie-chart"></canvas>
    </div>

    <!-- chart script started -->
    <script>
      let labels1 = [];
      let dataSet = [];

      let pieChartAgeGrouplabels = [];
      let pieChartAgeGroupData = [];
      let pieChartAgeGroupBgColor = [];

      // function to generate random color for pie chart
      function generateRandomColor() {
        let maxVal = 0xffffff; // 16777215
        let randomNumber = Math.random() * maxVal;
        randomNumber = Math.floor(randomNumber);
        randomNumber = randomNumber.toString(16);
        let randColor = randomNumber.padStart(6, 0);
        return `#${randColor.toUpperCase()}`;
      }

      fetch(
        "https://health.data.ny.gov/resource/gnzp-ekau.json?$where=UPPER(ccs_diagnosis_description) like '%25CANCER%25' AND discharge_year>1900&$limit=1000",
				{
					headers:{
						"X-App-Token":"VGBwLqJXM1nElaK4TzfX7zrm0"
					}
				}
      )
        .then((resp) => resp.json())
        .then((response) => {
          console.log(response);
          for (let i = 0; i < response.length; i++) {
            // console.log("response discharge year == ", i, response[i]);
            if (
              response[i].discharge_year &&
              !labels1.includes(response[i].discharge_year)
            ) {
              labels1.push(response[i].discharge_year);
            }
            if (
              response[i].age_group &&
              !pieChartAgeGrouplabels.includes(response[i].age_group)
            ) {
              pieChartAgeGrouplabels.push(response[i].age_group);
            }
          }
          for (let j = 0; j < labels1.length; j++) {
            // console.log(response)
            let list = response.filter((x) => x.discharge_year === labels1[j]);
            dataSet[j] = list.length;
          }

          for (let j = 0; j < pieChartAgeGrouplabels.length; j++) {
            let list = response.filter(
              (x) => x.age_group === pieChartAgeGrouplabels[j]
            );
            pieChartAgeGroupData[j] = list.length;
            pieChartAgeGroupBgColor[j] = generateRandomColor();
          }
          // console.log("labels1 === ", labels1);
          // console.log("dataset ===", dataSet);
          // console.log("Pie Chart labels === ", pieChartAgeGrouplabels);
          // console.log("pieChartAgeGroupData === ", pieChartAgeGroupData);
          // a=response;
          // console.log("a === ", a);

          // data config starts line chart
          const data = {
            labels: labels1,
            datasets: [
              {
                label: "Cancer patients discharged after 1900",
                backgroundColor: "rgb(255, 99, 132)",
                borderColor: "rgb(255, 99, 132)",
                data: dataSet
              }
            ]
          };

          var options = {
            maintainAspectRatio: false,
            scales: {
              y: {
                stacked: true,
                grid: {
                  display: true,
                  color: "rgba(255,99,132,0.2)"
                }
              },
              x: {
                grid: {
                  display: false
                }
              }
            }
          };

          const config = {
            type: "line",
            data: data,
            // options: options
          };

          const myChart = new Chart(document.getElementById("myChart"), config);
          // data config starts line ends

          // pie chart config starts chart
          new Chart(document.getElementById("age-group-pie-chart"), {
            type: "pie",
            data: {
              labels: pieChartAgeGrouplabels,
              datasets: [
                {
                  label: "Cancer patients (by age group)",
                  backgroundColor: pieChartAgeGroupBgColor,
                  data: pieChartAgeGroupData
                }
              ]
            },
            options: {
              title: {
                display: true
                // text: ""
              }
            }
          });
          // pie chart config starts ends
        })
        .catch((error) => {
          console.log(error);
        });
    </script>
    <!-- charting script ended -->
  </body>
</html>
